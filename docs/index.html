<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>site is offline rn.</title>
    <link rel="stylesheet" href="res/styles.css"/>
    <link rel="icon" type="image/x-icon" href="res/favicon.png">
    <style>
        /* Subtle spinner for the retry button */
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.8;
        }

        .loading::after {
            content: "";
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: translateY(-50%) rotate(360deg);
            }
        }
    </style>
</head>
<body>
<div class="container" id="main-view">
    <a href="https://www.fonseware.com/">
        <div class="img-wrapper skeleton">
            <img alt="logo" src="res/logo.png" loading="lazy"/>
        </div>
    </a>

    <h1 id="offline-title" class="skeleton" style="font-family: 'InstrumentSerif-Italic', serif;">
        fonseware is offline rn.
    </h1>

    <p id="offline-subtitle" class="tagline topics skeleton">
        i might be doing updates or sleeping lol. come back at another time and i am very sorry for the
        inconvenience caused.
    </p>

    <!-- ðŸ†• moved here, with skeleton -->
    <button id="retry-button" class="incident-button skeleton" style="display: none;">Try Again</button>

    <div class="card skeleton">
        <p class="tagline" style="text-align: left; margin-bottom: -5px">
            <strong style="font-family: 'InstrumentSerif-Regular',serif;" class="topics">why am i seeing this error?</strong>
            <br> my website runs on a home-hosted webserver. sometimes it goes offline for
            maintenance or when my computer needs a break.
            <br><br>
            you can also check my <a href="https://www.fonseware.com/status/">server status here</a>.
        </p>
    </div>

    <footer class="tagline topics skeleton">&copy; 2025 fonseware. all rights reserved.</footer>
</div>

<script src="res/lazyload.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Extract "url" parameter from query string ---
        const params = new URLSearchParams(window.location.search);
        const offlineUrl = params.get('url');

        if (offlineUrl) {
            try {
                const parsedUrl = new URL(offlineUrl);
                const subdomain = parsedUrl.hostname.split('.')[0] !== 'fonseware' ? parsedUrl.hostname : 'main site';

                // Update title and subtitle text dynamically
                document.title = `${subdomain} is offline rn.`;
                document.getElementById('offline-title').textContent = `${subdomain} is offline rn.`;
                document.getElementById('offline-subtitle').textContent = `${offlineUrl} is unreachable at the moment. Please try again later.`;

                // Show retry button
                const retryButton = document.getElementById('retry-button');
                retryButton.style.display = 'block';
                retryButton.addEventListener('click', () => {
                    retryButton.classList.add('loading');
                    retryButton.textContent = 'Trying...';
                    setTimeout(() => {
                        window.location.href = offlineUrl;
                    }, 800);
                });
            } catch (err) {
                console.error('Invalid URL parameter:', err);
            }
        }

        // --- Skeleton loader reveal logic ---
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const delay = Math.random() * (3500 - 1500) + 500;
                    setTimeout(() => {
                        entry.target.classList.remove('skeleton');
                        observer.unobserve(entry.target);
                    }, delay);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.skeleton').forEach(el => observer.observe(el));

        // --- Handle lazy image loading ---
        document.querySelectorAll('.img-wrapper img').forEach(img => {
            if (img.complete && img.naturalWidth !== 0) {
                img.classList.add('loaded');
                img.parentElement.classList.add('loaded-wrapper');
                img.parentElement.classList.remove('skeleton');
            } else {
                img.addEventListener('load', () => {
                    img.classList.add('loaded');
                    img.parentElement.classList.add('loaded-wrapper');
                    img.parentElement.classList.remove('skeleton');
                });
                setTimeout(() => {
                    if (!img.classList.contains('loaded')) {
                        img.classList.add('loaded');
                        img.parentElement.classList.add('loaded-wrapper');
                        img.parentElement.classList.remove('skeleton');
                    }
                }, 10000);
            }
        });
    });
</script>
</body>
</html>
